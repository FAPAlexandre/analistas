{% load l10n %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="30"> 
    <title>Dashboard de Metas</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* Cores Vibrantes para os Cards Globais */
        .bg-bronze-viva { background-color: #d2691e !important; color: white !important; }
        .bg-prata-viva  { background-color: #7f8c8d !important; color: white !important; }
        .bg-ouro-viva   { background-color: #ff8c00 !important; color: white !important; }
        
        /* Cores de Status DinÃ¢mico */
        .bg-bronze { background-color: #cd7f32 !important; color: white !important; }
        .bg-prata  { background-color: #c0c0c0 !important; color: #333 !important; }
        .bg-ouro   { background-color: #ffd700 !important; color: #333 !important; }
        
        .card-meta { border-radius: 15px; overflow: hidden; border: none; }
        .rank-medal { font-size: 1.2rem; }
        .badge-meta { font-size: 0.85rem; padding: 0.5em 0.8em; min-width: 110px; }
        
        .analista-pill {
            display: inline-flex;
            align-items: center;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.15rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            gap: 12px;
            min-width: 220px;
        }

        .status-texto {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
            margin-top: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid px-4 py-4">
        
        <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-3 rounded shadow-sm">
            <div>
                <h1 class="h3 mb-0 fw-bold">ğŸš€ GestÃ£o de ArrecadaÃ§Ã£o</h1>
                <p class="text-muted mb-0 small">Performance em tempo real</p>
            </div>
            <div class="btn-group shadow-sm">
                <div class="btn-group">
                    <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown">
                        ğŸ“¥ Exportar Excel
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'exportar_excel' %}?tipo=mensal">ğŸ“Š RelatÃ³rio Mensal</a></li>
                        <li><a class="dropdown-item" href="{% url 'exportar_excel' %}?tipo=anual">ğŸ“… RelatÃ³rio Anual</a></li>
                    </ul>
                </div>
                <a href="{% url 'cadastro' %}" class="btn btn-secondary ms-2">âš™ï¸ LanÃ§amentos</a>
            </div>
        </div>

        {% for item in dados %}
        <div class="card mb-5 shadow-sm card-meta">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center py-3">
                <h2 class="h4 mb-0">ğŸ¢ {{ item.empresa.nome }}</h2>
                <span class="badge bg-primary fs-6">ğŸ“… Dias Ãšteis Restantes: {{ item.meta_global.dias_uteis_restantes }}</span>
            </div>
            
            <div class="card-body p-4">
                <h5 class="text-secondary border-bottom pb-2 mb-3 fw-bold">ğŸ“Š Performance da Equipe</h5>
                
                <div class="row g-3 text-center mb-5">
                    
                    <div class="col-md-3">
                        <div class="p-3 border-0 rounded-4 shadow h-100 
                            {% if item.meta_global.total_arrecadado_equipe >= item.meta_global.ouro_global %} bg-ouro
                            {% elif item.meta_global.total_arrecadado_equipe >= item.meta_global.prata_global %} bg-prata
                            {% elif item.meta_global.total_arrecadado_equipe >= item.meta_global.bronze_global %} bg-bronze
                            {% else %} bg-primary text-white {% endif %}">
                            <small class="opacity-75 fw-bold text-uppercase">Total Arrecadado</small><br>
                            <span class="h4 fw-bold">R$ {{ item.meta_global.total_arrecadado_equipe|floatformat:2 }}</span><br>
                            <small class="fw-bold d-block mt-1">ğŸš€ Em busca da meta</small>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="p-3 border-0 rounded-4 shadow h-100 bg-bronze-viva text-white">
                            <small class="fw-bold text-uppercase">ğŸ¥‰ Meta Bronze: R$ {{ item.meta_global.bronze_global|floatformat:2 }}</small>
                            <hr class="my-2 border-white opacity-25">
                            <small class="d-block mb-1 opacity-75">Falta para atingir:</small>
                            <span class="h5 fw-bold">R$ {{ item.meta_global.falta_bronze_global|floatformat:2 }}</span>
                            
                            <div class="mt-2 py-2 px-2 rounded bg-white bg-opacity-25">
                                <small class="fw-bold d-block">
                                    ğŸ¯ NecessÃ¡rio: R$ {{ item.meta_global.diario_bronze|floatformat:2 }} / dia
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="p-3 border-0 rounded-4 shadow h-100 bg-prata-viva text-white">
                            <small class="fw-bold text-uppercase">ğŸ¥ˆ Meta Prata: R$ {{ item.meta_global.prata_global|floatformat:2 }}</small>
                            <hr class="my-2 border-white opacity-25">
                            <small class="d-block mb-1 opacity-75">Falta para atingir:</small>
                            <span class="h5 fw-bold">R$ {{ item.meta_global.falta_prata_global|floatformat:2 }}</span>
                            
                            <div class="mt-2 py-2 px-2 rounded bg-white bg-opacity-25">
                                <small class="fw-bold d-block">
                                    ğŸ¯ NecessÃ¡rio: R$ {{ item.meta_global.diario_prata|floatformat:2 }} / dia
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="p-3 border-0 rounded-4 shadow h-100 bg-ouro-viva text-white">
                            <small class="fw-bold text-uppercase">ğŸ† Meta Ouro: R$ {{ item.meta_global.ouro_global|floatformat:2 }}</small>
                            <hr class="my-2 border-white opacity-25">
                            <small class="d-block mb-1 opacity-75">Falta para atingir:</small>
                            <span class="h5 fw-bold">R$ {{ item.meta_global.falta_ouro_global|floatformat:2 }}</span>
                            
                            <div class="mt-2 py-2 px-2 rounded bg-white bg-opacity-25">
                                <small class="fw-bold d-block">
                                    ğŸ¯ NecessÃ¡rio: R$ {{ item.meta_global.diario_ouro|floatformat:2 }} / dia
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <h5 class="text-secondary border-bottom pb-2 mb-3 fw-bold">ğŸ† Ranking Individual</h5>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light text-center">
                            <tr class="text-muted small">
                                <th style="width: 80px;">RANK</th>
                                <th class="text-start">ANALISTA E STATUS</th>
                                <th>ğŸ¥‰ BRONZE</th>
                                <th>ğŸ¥ˆ PRATA</th>
                                <th>ğŸ† OURO</th>
                                <th class="text-end px-4">TOTAL ACUMULADO</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for analista in item.analistas %}
                            <tr class="text-center">
                                <td>
                                    <span class="rank-medal">
                                        {% if forloop.counter == 1 %}ğŸ¥‡{% elif forloop.counter == 2 %}ğŸ¥ˆ{% elif forloop.counter == 3 %}ğŸ¥‰{% else %}{{ forloop.counter }}Âº{% endif %}
                                    </span>
                                </td>
                                <td class="text-start">
                                    <div class="analista-pill 
                                        {% if analista.falta_ouro <= 0 %} bg-ouro
                                        {% elif analista.falta_prata <= 0 %} bg-prata
                                        {% elif analista.falta_bronze <= 0 %} bg-bronze
                                        {% else %} bg-white text-dark border {% endif %}">
                                        <span>{% if analista.falta_ouro <= 0 %}ğŸ†{% elif analista.falta_prata <= 0 %}ğŸ¥ˆ{% elif analista.falta_bronze <= 0 %}ğŸ¥‰{% else %}ğŸ‘¤{% endif %}</span>
                                        <span>{{ analista.nome }}</span>
                                    </div>
                                    <div class="ps-3 mt-1">
                                        {% if analista.falta_ouro <= 0 %}<span class="status-texto text-warning">âœ¨ Bateu Ouro!</span>
                                        {% elif analista.falta_prata <= 0 %}<span class="status-texto text-secondary">â­ Bateu Prata!</span>
                                        {% elif analista.falta_bronze <= 0 %}<span class="status-texto" style="color: #cd7f32;">ğŸ”¸ Bateu Bronze!</span>
                                        {% else %}<span class="status-texto text-muted">Em busca da meta</span>{% endif %}
                                    </div>
                                </td>
                                <td>
                                    {% if analista.falta_bronze > 0 %}<span class="badge bg-light text-dark border badge-meta">Falta R$ {{ analista.falta_bronze|floatformat:2 }}</span>
                                    {% else %}<div class="h5 mb-0 text-success fw-bold">BATIDA ğŸ¥‰</div>{% endif %}
                                </td>
                                <td>
                                    {% if analista.falta_prata > 0 %}<span class="badge bg-light text-dark border badge-meta">Falta R$ {{ analista.falta_prata|floatformat:2 }}</span>
                                    {% else %}<div class="h5 mb-0 text-success fw-bold">BATIDA ğŸ¥ˆ</div>{% endif %}
                                </td>
                                <td>
                                    {% if analista.falta_ouro > 0 %}<span class="badge bg-light text-dark border badge-meta">Falta R$ {{ analista.falta_ouro|floatformat:2 }}</span>
                                    {% else %}<div class="h5 mb-0 text-success fw-bold">BATIDA ğŸ†</div>{% endif %}
                                </td>
                                <td class="text-end px-4">
                                    <span class="h5 mb-0 fw-bold text-primary">R$ {{ analista.total_mes|default:0|floatformat:2 }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>