{% load l10n %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="30"> 
    <title>Dashboard de Metas</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* Cores Vibrantes para os Cards Globais */
        .bg-bronze-viva { background-color: #d2691e !important; color: white !important; }
        .bg-prata-viva  { background-color: #7f8c8d !important; color: white !important; }
        .bg-ouro-viva   { background-color: #ff8c00 !important; color: white !important; }
        
        /* Cores de Status Din√¢mico */
        .bg-bronze { background-color: #cd7f32 !important; color: white !important; }
        .bg-prata  { background-color: #c0c0c0 !important; color: #333 !important; }
        .bg-ouro   { background-color: #ffd700 !important; color: #333 !important; }
        
        .card-meta { border-radius: 15px; overflow: hidden; border: none; }
        .rank-medal { font-size: 1.2rem; }
        .badge-meta { font-size: 0.85rem; padding: 0.5em 0.8em; min-width: 110px; }
        
        .analista-pill {
            display: inline-flex;
            align-items: center;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.15rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            gap: 12px;
            min-width: 220px;
        }

        .status-texto {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
            margin-top: 4px;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container-fluid px-4 py-4">
        
        <div class="d-flex justify-content-between align-items-center mb-4 bg-white p-3 rounded shadow-sm">
            <div>
                <h1 class="h3 mb-0 fw-bold">üöÄ Gest√£o de Arrecada√ß√£o</h1>
                <p class="text-muted mb-0 small">Performance em tempo real</p>
            </div>
            <div class="btn-group shadow-sm">
                <div class="btn-group">
                    <button type="button" class="btn btn-success dropdown-toggle" data-bs-toggle="dropdown">
                        üì• Exportar Excel
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'exportar_excel' %}?tipo=mensal">üìä Relat√≥rio Mensal</a></li>
                        <li><a class="dropdown-item" href="{% url 'exportar_excel' %}?tipo=anual">üìÖ Relat√≥rio Anual</a></li>
                    </ul>
                </div>
                <a href="{% url 'cadastro' %}" class="btn btn-secondary ms-2">‚öôÔ∏è Lan√ßamentos</a>
            </div>
        </div>

        {% for item in dados %}
        <div class="card mb-5 shadow-sm card-meta">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center py-3">
                <h2 class="h4 mb-0">üè¢ {{ item.empresa.nome }}</h2>
                <span class="badge bg-primary fs-6">üìÖ Dias √öteis Restantes: {{ item.meta_global.dias_uteis_restantes }}</span>
            </div>
            
            <div class="card-body p-4">
                <h5 class="text-secondary border-bottom pb-2 mb-3 fw-bold">üìä Performance da Equipe</h5>
                
                <div class="row g-3 text-center mb-5">
                    <div class="col-md-3">
                        <div class="p-3 border-0 rounded-4 shadow h-100 
                            {% if item.meta_global.total_arrecadado_equipe >= item.meta_global.ouro_global and item.meta_global.ouro_global > 0 %} bg-ouro
                            {% elif item.meta_global.total_arrecadado_equipe >= item.meta_global.prata_global and item.meta_global.prata_global > 0 %} bg-prata
                            {% elif item.meta_global.total_arrecadado_equipe >= item.meta_global.bronze_global and item.meta_global.bronze_global > 0 %} bg-bronze
                            {% else %} bg-primary text-white {% endif %}">
                            <small class="opacity-75 fw-bold text-uppercase">Total Arrecadado Equipe</small><br>
                            <span class="h4 fw-bold">R$ {{ item.meta_global.total_arrecadado_equipe|floatformat:2 }}</span><br>
                            
                            <small class="fw-bold d-block mt-1">
                                {% if item.meta_global.total_arrecadado_equipe >= item.meta_global.ouro_global and item.meta_global.ouro_global > 0 %} üèÜ EQUIPE OURO!
                                {% elif item.meta_global.total_arrecadado_equipe >= item.meta_global.prata_global and item.meta_global.prata_global > 0 %} ü•à EQUIPE PRATA!
                                {% elif item.meta_global.total_arrecadado_equipe >= item.meta_global.bronze_global and item.meta_global.bronze_global > 0 %} ü•â EQUIPE BRONZE!
                                {% else %} üöÄ EM BUSCA DA META {% endif %}
                            </small>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="p-3 border-0 rounded-4 shadow h-100 bg-bronze-viva text-white">
                            <small class="fw-bold text-uppercase">ü•â Meta Bronze: R$ {{ item.meta_global.bronze_global|floatformat:2 }}</small>
                            <hr class="my-2 border-white opacity-25">
                            <span class="h5 fw-bold">
                                {% if item.meta_global.total_arrecadado_equipe >= item.meta_global.bronze_global %} ‚úÖ ATINGIDA!
                                {% else %} Falta: R$ {{ item.meta_global.falta_bronze_global|floatformat:2 }}{% endif %}
                            </span>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="p-3 border-0 rounded-4 shadow h-100 bg-prata-viva text-white">
                            <small class="fw-bold text-uppercase">ü•à Meta Prata: R$ {{ item.meta_global.prata_global|floatformat:2 }}</small>
                            <hr class="my-2 border-white opacity-25">
                            <span class="h5 fw-bold">
                                {% if item.meta_global.total_arrecadado_equipe >= item.meta_global.prata_global %} ‚úÖ ATINGIDA!
                                {% else %} Falta: R$ {{ item.meta_global.falta_prata_global|floatformat:2 }}{% endif %}
                            </span>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="p-3 border-0 rounded-4 shadow h-100 bg-ouro-viva text-white">
                            <small class="fw-bold text-uppercase">üèÜ Meta Ouro: R$ {{ item.meta_global.ouro_global|floatformat:2 }}</small>
                            <hr class="my-2 border-white opacity-25">
                            <span class="h5 fw-bold">
                                {% if item.meta_global.total_arrecadado_equipe >= item.meta_global.ouro_global %} ‚úÖ ATINGIDA!
                                {% else %} Falta: R$ {{ item.meta_global.falta_ouro_global|floatformat:2 }}{% endif %}
                            </span>
                        </div>
                    </div>
                </div>

                <h5 class="text-secondary border-bottom pb-2 mb-3 fw-bold">üèÜ Ranking Individual</h5>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light text-center">
                            <tr class="text-muted small">
                                <th style="width: 80px;">RANK</th>
                                <th class="text-start">ANALISTA E STATUS</th>
                                <th>ü•â BRONZE</th>
                                <th>ü•à PRATA</th>
                                <th>üèÜ OURO</th>
                                <th class="text-end px-4">TOTAL ACUMULADO</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for analista in item.analistas %}
                            <tr class="text-center">
                                <td>
                                    <span class="rank-medal">
                                        {% if forloop.counter == 1 %}ü•á{% elif forloop.counter == 2 %}ü•à{% elif forloop.counter == 3 %}ü•â{% else %}{{ forloop.counter }}¬∫{% endif %}
                                    </span>
                                </td>
                                <td class="text-start">
                                    <div class="analista-pill 
                                        {% if analista.total_mes >= analista.meta_ouro_ref and analista.meta_ouro_ref > 0 %} bg-ouro
                                        {% elif analista.total_mes >= analista.meta_prata_ref and analista.meta_prata_ref > 0 %} bg-prata
                                        {% elif analista.total_mes >= analista.meta_bronze_ref and analista.meta_bronze_ref > 0 %} bg-bronze
                                        {% else %} bg-white text-dark border {% endif %}">
                                        <span>
                                            {% if analista.total_mes >= analista.meta_ouro_ref and analista.meta_ouro_ref > 0 %}üèÜ
                                            {% elif analista.total_mes >= analista.meta_prata_ref and analista.meta_prata_ref > 0 %}ü•à
                                            {% elif analista.total_mes >= analista.meta_bronze_ref and analista.meta_bronze_ref > 0 %}ü•â
                                            {% else %}üë§{% endif %}
                                        </span>
                                        <span>{{ analista.nome }}</span>
                                    </div>
                                    <div class="ps-3 mt-1">
                                        {% if analista.total_mes >= analista.meta_ouro_ref and analista.meta_ouro_ref > 0 %}
                                            <span class="status-texto text-warning">‚ú® Bateu Ouro!</span>
                                        {% elif analista.total_mes >= analista.meta_prata_ref and analista.meta_prata_ref > 0 %}
                                            <span class="status-texto text-secondary">‚≠ê Bateu Prata!</span>
                                        {% elif analista.total_mes >= analista.meta_bronze_ref and analista.meta_bronze_ref > 0 %}
                                            <span class="status-texto" style="color: #cd7f32;">üî∏ Bateu Bronze!</span>
                                        {% else %}
                                            <span class="status-texto text-muted">üöÄ Em busca da meta</span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>
                                    {% if analista.total_mes < analista.meta_bronze_ref %}
                                        <span class="badge bg-light text-dark border badge-meta">Falta R$ {{ analista.falta_bronze|floatformat:2 }}</span>
                                    {% else %}
                                        <div class="h5 mb-0 text-success fw-bold">BATIDA ü•â</div>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if analista.total_mes < analista.meta_prata_ref %}
                                        <span class="badge bg-light text-dark border badge-meta">Falta R$ {{ analista.falta_prata|floatformat:2 }}</span>
                                    {% else %}
                                        <div class="h5 mb-0 text-success fw-bold">BATIDA ü•à</div>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if analista.total_mes < analista.meta_ouro_ref %}
                                        <span class="badge bg-light text-dark border badge-meta">Falta R$ {{ analista.falta_ouro|floatformat:2 }}</span>
                                    {% else %}
                                        <div class="h5 mb-0 text-success fw-bold">BATIDA üèÜ</div>
                                    {% endif %}
                                </td>
                                <td class="text-end px-4">
                                    <span class="h5 mb-0 fw-bold text-primary">R$ {{ analista.total_mes|default:0|floatformat:2 }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>